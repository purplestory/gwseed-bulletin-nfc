<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>높은뜻씨앗이되어교회 주보</title>
    <link rel="preload" href="assets/static_thumbnail.jpg" as="image">
    <!-- <meta http-equiv="refresh" content="1.5; url=https://www.godswillseed.or.kr/bbs/board.php?bo_table=weekly&wr_id=763"> -->
    <style>
        * {
            box-sizing: border-box; /* 레이아웃 계산 방식 통일 */
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            text-align: center;
            padding: 20px 20px; /* 상단 여백 추가, 좌우 여백 유지 */
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #495057;
        }
        .container {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            border: 1px solid rgba(0,0,0,0.1);
            margin: 0 auto; /* 수평 중앙 정렬 추가 */
        }
        h1 { 
            margin-bottom: 20px; 
            font-size: 1.4em;
            color: #2c3e50;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .thumbnail-container {
            margin: 20px auto;
            min-height: 100px; /* 로딩 중 공간 유지 */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .bulletin-thumbnail {
            width: 200px;
            max-height: 280px;
            object-fit: contain;
            border: 1px solid #ddd; /* 얇은 테두리 추가 */
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
            margin: 0 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .manual-link {
            margin-top: 10px;
            padding: 15px 30px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-radius: 10px;
            text-decoration: none;
            color: white;
            display: inline-block;
            transition: all 0.3s ease;
            border: none;
            font-weight: 500;
        }
        .manual-link:hover {
            background: linear-gradient(135deg, #2980b9 0%, #1f5f8b 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        .status-text {
            font-size: 1.1em;
            margin: 15px 0;
            color: #6c757d;
        }
        .redirect-info {
            font-size: 0.9em;
            color: #868e96;
            margin-top: 20px;
        }
        .error-text {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>높은뜻씨앗이되어교회</h1>
        <p class="status-text">이번주 주보로 이동 중입니다...</p>
        
        <div class="thumbnail-container">
            <img id="bulletin-thumbnail" src="assets/thumbnail_2026.jpg" alt="높은뜻씨앗이되어교회 주보" class="bulletin-thumbnail">
        </div>
        
        <div class="loading"></div>
        
        <div style="margin-top: 30px;">
            <a href="https://www.godswillseed.or.kr/bbs/board.php?bo_table=weekly&wr_id=763" 
               class="manual-link">
                이번주 주보로 이동
            </a>
        </div>
        
        <p class="redirect-info">
            자동으로 이동되지 않으면 버튼을 눌러주세요
        </p>
        
        <p id="error-text" class="error-text" style="display: none;">
            주보 정보를 가져오는데 실패했습니다.
        </p>
    </div>
    <script>
        // 기본 주보 페이지 URL
        const baseUrl = 'https://www.godswillseed.or.kr/bbs/board.php?bo_table=weekly';
        
        // 최신 주보 정보 가져오기
        async function getLatestBulletin() {
            let bulletinUrl = baseUrl;
            
            try {
                // 먼저 Vercel API 시도, 실패하면 GitHub raw 파일 직접 읽기
                let response = await fetch('/api/get-latest');
                console.log('Vercel API 응답 상태:', response.status, response.ok);
                
                // API가 HTML을 반환하면 (라우팅 문제) GitHub raw 파일 직접 읽기
                if (!response.ok || response.headers.get('content-type')?.includes('text/html')) {
                    console.warn('Vercel API 실패, GitHub raw 파일 직접 읽기');
                    const githubRawUrl = 'https://raw.githubusercontent.com/purplestory/gwseed-bulletin-nfc/main/latest_bulletin.json';
                    response = await fetch(githubRawUrl, {
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        }
                    });
                }
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('API 응답 데이터:', data);
                    
                    // 썸네일 이미지는 이미 HTML에서 thumbnail_2026.jpg로 설정되어 있음
                    // 추가 처리 불필요
                    
                    // 완전한 URL을 반환하면 그것을 사용, 아니면 wr_id로 구성
                    if (data.url && data.url.includes('wr_id=')) {
                        bulletinUrl = data.url;
                        console.log('받은 완전한 URL 사용:', bulletinUrl);
                    } else if (data.wr_id) {
                        // wr_id가 있으면 특정 주보로 리다이렉트
                        bulletinUrl = `${baseUrl}&wr_id=${data.wr_id}`;
                        console.log('wr_id로 구성한 URL:', bulletinUrl);
                    } else {
                        console.warn('wr_id가 없습니다. 주보 리스트 페이지로 이동합니다.');
                    }
                } else {
                    console.error('API 응답 실패:', response.status, response.statusText);
                }
            } catch (error) {
                console.error('주보 정보 가져오기 실패, 주보 리스트 페이지로 이동:', error);
                // API 실패 시에도 주보 리스트 페이지로 이동
            }
            
            // 링크 업데이트
            const linkElement = document.querySelector('.manual-link');
            if (linkElement) {
                linkElement.href = bulletinUrl;
            }
            
            console.log('최종 리다이렉트 URL:', bulletinUrl);
            
            // 0.5초 후에 리다이렉트
            setTimeout(function() {
                window.location.href = bulletinUrl;
            }, 500);
        }
        
        // 페이지 로드 시 최신 주보 정보 가져오기
        getLatestBulletin();
    </script>
</body>
</html> 